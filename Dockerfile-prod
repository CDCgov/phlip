FROM node:8.11.4

ARG APP_API_URL
ARG APP_DOC_MANAGE_API
ARG APP_LOG_REQUESTS
ARG APP_IS_HTTPS
ARG APP_IS_SAML_ENABLED
ARG APP_SAML_REQUEST_URL

ENV NPM_CONFIG_LOGLEVEL error
ENV APP_API_URL=$APP_API_URL
ENV APP_DOC_MANAGE_API=$APP_DOC_MANAGE_API
ENV APP_LOG_REQUESTS=$APP_LOG_REQUESTS
ENV APP_IS_HTTPS=$APP_IS_HTTPS
ENV APP_IS_SAML_ENABLED=$APP_IS_SAML_ENABLED
ENV APP_SAML_REQUEST_URL=$APP_SAML_REQUEST_URL

SHELL ["/bin/bash", "-c"]

RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app
COPY . .

RUN npm install
RUN npm run build
RUN npm install --production --no-optional
RUN npm dedupe

ENV NODE_ENV production

CMD npm run serve:local